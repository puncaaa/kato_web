{% extends 'website/base.html' %}
{% block content %}
<h1>{{ pub.title }}</h1>
<p class="small text-muted">{{ pub.authors }} — {{ pub.year }}</p>
<div>{{ pub.description|linebreaks }}</div>
{% if pub.pdf %}<p class="mt-3"><a href="{{ pub.pdf.url }}" class="btn btn-outline-primary">Скачать PDF</a></p>{% endif %}

<hr/>
<h5>Комментарии</h5>
{% for c in comments %}
  <div class="mb-2">
    <strong>{{ c.user.username }}</strong> <small class="text-muted">{{ c.created_at|date:"d M Y H:i" }}</small>
    <div>{{ c.content|linebreaks }}</div>
  </div>
{% empty %}
  <p>Пока нет комментариев.</p>
{% endfor %}

{% if user.is_authenticated %}
  <form action="{% url 'add_comment' %}" method="post" class="mt-3">
    {% csrf_token %}
    <input type="hidden" name="model" value="publication">
    <input type="hidden" name="slug" value="{{ pub.slug }}">
    {{ comment_form.content }}
    <button class="btn btn-primary mt-2">Отправить</button>
  </form>
{% else %}
  <p><a href="{% url 'login' %}">Войдите</a>, чтобы оставить комментарий.</p>
{% endif %}
{% endblock %}
